(this["webpackJsonpstreet-view-reconstruction"]=this["webpackJsonpstreet-view-reconstruction"]||[]).push([[0],{14:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return c}));var n=a(27),r=a(28),o=a(29);function i(e,t){for(var a=new Array(t),n=0;n<t;n++)a[n]=new Array(e);return a}function l(e){return"https://maps.google.com/cbk?"+Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")}var c=function(){function t(){Object(n.a)(this,t)}return Object(r.a)(t,null,[{key:"fetchStreetViewImage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=l({output:"json",ll:"".concat(e,",").concat(t),dm:1});return fetch(a).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()}))}},{key:"parseDepthMapString",value:function(a,n){for(;a.length%4!==0;)a+="=";a=(a=a.replace(/-/g,"+")).replace(/_/g,"/"),Object(o.inflate)(e.from(a,"base64"),(function(e,a){if(e)throw e;var r=function(e){for(var t=new Uint8Array(e.length),a=0;a<e.length;++a)t[a]=e[a];return new DataView(t.buffer)}(a),o=t.getDepthMapMetaData(r),i=t.getStreetViewGeometry(o,r),l=t.getDepthImage(i);n([{metaData:o,bufferData:r,geometry:i},l])}))}},{key:"getDepthMapMetaData",value:function(e){return{metaDataSize:e.getUint8(0),numberOfPlanes:e.getUint16(1,!0),width:e.getUint16(3,!0),height:e.getUint16(5,!0),offset:e.getUint16(7,!0)}}},{key:"getStreetViewGeometry",value:function(e,t){for(var a=new Array(e.numberOfPlanes),n=i(e.width,e.height),r=0;r<e.height;r++)for(var o=0;o<e.width;o++)n[r][o]=t.getUint8(e.offset+o+r*e.width);for(var l=e.offset+e.height*e.width,c=0;c<e.numberOfPlanes;++c){var u=l+4*c*4;a[c]={n:{x:t.getFloat32(u,!0),y:t.getFloat32(u+4,!0),z:t.getFloat32(u+8,!0)},d:t.getFloat32(u+12,!0)}}return{width:e.width,height:e.height,planes:a,planeIndices:n}}},{key:"getDepthImage",value:function(e){for(var t,a,n=i(e.width,e.height),r=0;r<n.length;r++)for(var o=(e.height-r-.5)/e.height*Math.PI,l=Math.sin(o),c=Math.cos(o),u=0;u<n[0].length;u++){var h=e.planeIndices[r][u];if(h>0){var s=2*(e.width-u-.5)*Math.PI/e.width,g={x:l*Math.cos(s),y:l*Math.sin(s),z:c},f=e.planes[h],m=Math.abs(f.d/(t=f.n,a=g,t.x*a.x+t.y*a.y+t.z*a.z));n[r][u]=m}else n[r][u]=0}return n}}]),t}()}).call(this,a(1).Buffer)},30:function(e,t,a){e.exports=a(63)},35:function(e,t,a){},36:function(e,t,a){},40:function(e,t){},42:function(e,t){},63:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(26),i=a.n(o),l=(a(35),a(7)),c=(a(36),a(14)),u=parseFloat("37.7769799,-122.3949447".split(",")[0]),h=parseFloat("37.7769799,-122.3949447".split(",")[1]),s={0:[255,255,255],1:[255,0,0],2:[0,255,0],3:[0,0,255],4:[255,255,0],5:[255,0,255],6:[0,255,255]},g=function(){var e=Object(n.useState)(void 0),t=Object(l.a)(e,2),a=t[0],o=t[1],i=Object(n.useState)(void 0),g=Object(l.a)(i,2),f=g[0],m=g[1],d=Object(n.useState)(void 0),p=Object(l.a)(d,2),v=p[0],w=p[1],b=function(e){var t=Object(l.a)(e,2),a=t[0],n=t[1];o(a),m(n)};Object(n.useEffect)((function(){!function(){try{c.a.fetchStreetViewImage(u,h).then((function(e){c.a.parseDepthMapString(e.model.depth_map,b)}))}catch(e){console.log(e)}}(),w(new google.maps.StreetViewPanorama(document.getElementById("panorama")))}),[]),Object(n.useEffect)((function(){v&&(new google.maps.StreetViewService).getPanorama({location:new google.maps.LatLng(37.7769799,-122.3949447),radius:500},(function(e,t){t===google.maps.StreetViewStatus.OK&&(v.setPano(e.location.pano),v.setVisible(!0))}))}),[v]);Object(n.useEffect)((function(){var e=document.getElementById("depth-map__image");if(f&&e){var t=e.getContext("2d");null===t||void 0===t||t.clearRect(0,0,512,256);for(var n=0,r=f[0].length,o=f.length,i=t.createImageData(r,o),l=0;l<o;++l)for(var c=0;c<r;++c){var u=l*r+c,h=2.3*f[l][c];i.data[4*u]=h,i.data[4*u+1]=h,i.data[4*u+2]=h,i.data[4*u+3]=255,n=Math.max(f[l][c],n)}null===t||void 0===t||t.putImageData(i,0,0)}var g=document.getElementById("depth-map__planes");if(a&&g){var m=g.getContext("2d");null===m||void 0===m||m.clearRect(0,0,512,256);for(var d=a.geometry.planeIndices,p=m.createImageData(a.geometry.width,a.geometry.height),v=0;v<d.length;++v)for(var w=0;w<d[0].length;++w){var b=v*d[0].length+w,y=s[d[v][w]];y&&(p.data[4*b]=y[0],p.data[4*b+1]=y[1],p.data[4*b+2]=y[2]),p.data[4*b+3]=255}null===m||void 0===m||m.putImageData(p,0,0)}}),[f,a,!0,!0]);var y=a&&r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"Number of Planes"),r.a.createElement("td",null,a.metaData.numberOfPlanes))));return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("label",null,"Latitude: ",u),r.a.createElement("label",null,"Longitude: ",h),r.a.createElement("br",null),y,r.a.createElement("br",null),r.a.createElement("canvas",{id:"depth-map__planes",width:512,height:256}),r.a.createElement("canvas",{id:"depth-map__image",width:512,height:256}),r.a.createElement("div",{id:"panorama",style:{width:512,height:512}})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(g,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[30,1,2]]]);
//# sourceMappingURL=main.8d9a0b73.chunk.js.map