(this["webpackJsonpstreet-view-reconstruction"]=this["webpackJsonpstreet-view-reconstruction"]||[]).push([[0],{26:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return l}));var n=a(27),r=a(28),o=a(29);function i(e,t){for(var a=new Array(t),n=0;n<t;n++)a[n]=new Array(e);return a}function c(e){return"https://maps.google.com/cbk?"+Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")}var l=function(){function t(){Object(n.a)(this,t)}return Object(r.a)(t,null,[{key:"fetchStreetViewImage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=c({output:"json",ll:"".concat(e,",").concat(a),dm:1});return fetch(r).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(e){t.parseDepthMapString(e.model.depth_map,n)}))}},{key:"parseDepthMapString",value:function(a,n){for(;a.length%4!==0;)a+="=";a=(a=a.replace(/-/g,"+")).replace(/_/g,"/"),Object(o.inflate)(e.from(a,"base64"),(function(e,a){if(e)throw e;var r=function(e){for(var t=new Uint8Array(e.length),a=0;a<e.length;++a)t[a]=e[a];return new DataView(t.buffer)}(a),o=t.getDepthMapMetaData(r),i=t.getStreetViewGeometry(o,r),c=t.getDepthImage(i);n([{metaData:o,bufferData:r,geometry:i},c])}))}},{key:"getDepthMapMetaData",value:function(e){return{metaDataSize:e.getUint8(0),numberOfPlanes:e.getUint16(1,!0),width:e.getUint16(3,!0),height:e.getUint16(5,!0),offset:e.getUint16(7,!0)}}},{key:"getStreetViewGeometry",value:function(e,t){for(var a=new Array(e.numberOfPlanes),n=i(e.width,e.height),r=0;r<e.height;r++)for(var o=0;o<e.width;o++)n[r][o]=t.getUint8(e.offset+o+r*e.width);for(var c=e.offset+e.height*e.width,l=0;l<e.numberOfPlanes;++l){var u=c+4*l*4;a[l]={n:{x:t.getFloat32(u,!0),y:t.getFloat32(u+4,!0),z:t.getFloat32(u+8,!0)},d:t.getFloat32(u+12,!0)}}return{width:e.width,height:e.height,planes:a,planeIndices:n}}},{key:"getDepthImage",value:function(e){for(var t,a,n=i(e.width,e.height),r=0;r<n.length;r++)for(var o=(e.height-r-.5)/e.height*Math.PI,c=Math.sin(o),l=Math.cos(o),u=0;u<n[0].length;u++){var h=e.planeIndices[r][u];if(h>0){var s=2*(e.width-u-.5)*Math.PI/e.width,d={x:c*Math.cos(s),y:c*Math.sin(s),z:l},f=e.planes[h],g=Math.abs(f.d/(t=f.n,a=d,t.x*a.x+t.y*a.y+t.z*a.z));n[r][u]=g}else n[r][u]=0}return n}}]),t}()}).call(this,a(1).Buffer)},30:function(e,t,a){e.exports=a(66)},35:function(e,t,a){},36:function(e,t,a){},40:function(e,t){},42:function(e,t){},63:function(e,t,a){},64:function(e,t,a){},65:function(e,t,a){},66:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(25),i=a.n(o),c=(a(35),a(5)),l=(a(36),a(26)),u=(a(63),function(e){var t=e.width,a=e.height,o=e.depthImage;return Object(n.useEffect)((function(){var e=document.getElementById("depth-image");if(o&&e){var n=e.getContext("2d");null===n||void 0===n||n.clearRect(0,0,t,a);for(var r=0,i=n.createImageData(t,a),c=0;c<a;++c)for(var l=0;l<t;++l){var u=c*t+l,h=2.5*o[c][l];i.data[4*u]=h,i.data[4*u+1]=h,i.data[4*u+2]=h,i.data[4*u+3]=255,r=Math.max(o[c][l],r)}null===n||void 0===n||n.putImageData(i,0,0)}}),[o,t,a]),r.a.createElement("canvas",{id:"depth-image",className:"depth-image-canvas",width:t,height:a})}),h=(a(64),{0:[255,255,255],1:[255,0,0],2:[0,255,0],3:[0,0,255],4:[255,255,0],5:[255,0,255],6:[0,255,255]}),s=function(e){var t=e.planesData;return Object(n.useEffect)((function(){var e=document.getElementById("depth-planes");if(e&&t){var a=e.getContext("2d");null===a||void 0===a||a.clearRect(0,0,512,256);for(var n=t.planeIndices,r=a.createImageData(t.width,t.height),o=0;o<t.height;++o)for(var i=0;i<t.width;++i){var c=o*t.width+i,l=h[n[o][i]];l&&(r.data[4*c]=l[0],r.data[4*c+1]=l[1],r.data[4*c+2]=l[2]),r.data[4*c+3]=255}null===a||void 0===a||a.putImageData(r,0,0)}}),[t]),r.a.createElement("canvas",{id:"depth-planes",width:(null===t||void 0===t?void 0:t.width)||512,height:(null===t||void 0===t?void 0:t.height)||256})},d=function(e){var t=e.depthMapData;return t?r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"Number of Planes"),r.a.createElement("td",null,t.metaData.numberOfPlanes)))):null},f=(a(65),function(e){var t=e.location,a=Object(n.useState)(void 0),o=Object(c.a)(a,2),i=o[0],l=o[1];return Object(n.useEffect)((function(){l(new google.maps.StreetViewPanorama(document.getElementById("panorama")))}),[]),Object(n.useEffect)((function(){i&&(new google.maps.StreetViewService).getPanorama({location:t,radius:50},(function(e,t){t===google.maps.StreetViewStatus.OK&&(i.setPano(e.location.pano),i.setVisible(!0))}))}),[i,t]),r.a.createElement("div",{id:"panorama",style:{width:512,height:512}})}),g=parseFloat("37.7769799,-122.3949447".split(",")[0]),m=parseFloat("37.7769799,-122.3949447".split(",")[1]),p=function(){var e=Object(n.useState)(void 0),t=Object(c.a)(e,2),a=t[0],o=t[1],i=Object(n.useState)(void 0),h=Object(c.a)(i,2),p=h[0],v=h[1],w=Object(n.useState)(void 0),b=Object(c.a)(w,2),E=b[0],y=b[1],O=function(e){var t=Object(c.a)(e,2),a=t[0],n=t[1];o(a),v(a.geometry),y(n)};Object(n.useEffect)((function(){try{l.a.fetchStreetViewImage(g,m,O)}catch(e){console.log(e)}}),[]);return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("label",null,"Latitude: ",g),r.a.createElement("label",null,"Longitude: ",m),r.a.createElement("br",null),r.a.createElement(d,{depthMapData:a}),r.a.createElement("br",null),r.a.createElement(s,{planesData:p}),r.a.createElement(u,{width:512,height:256,depthImage:E}),r.a.createElement(f,{location:new google.maps.LatLng(g,m)})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(p,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[30,1,2]]]);
//# sourceMappingURL=main.b706b7f7.chunk.js.map