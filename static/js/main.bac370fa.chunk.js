(this["webpackJsonpstreet-view-reconstruction"]=this["webpackJsonpstreet-view-reconstruction"]||[]).push([[0],{26:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return l}));var n=a(27),o=a(28),r=a(29);function i(e,t){for(var a=new Array(t),n=0;n<t;n++)a[n]=new Array(e);return a}function c(e){return"https://maps.google.com/cbk?"+Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")}var l=function(){function t(){Object(n.a)(this,t)}return Object(o.a)(t,null,[{key:"fetchStreetViewImage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,o=c({output:"json",ll:"".concat(e,",").concat(a),dm:1});return fetch(o).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).then((function(e){t.parseDepthMapString(e.model.depth_map,n)}))}},{key:"parseDepthMapString",value:function(a,n){for(;a.length%4!==0;)a+="=";a=(a=a.replace(/-/g,"+")).replace(/_/g,"/"),Object(r.inflate)(e.from(a,"base64"),(function(e,a){if(e)throw e;var o=function(e){for(var t=new Uint8Array(e.length),a=0;a<e.length;++a)t[a]=e[a];return new DataView(t.buffer)}(a),r=t.getDepthMapMetaData(o),i=t.getStreetViewGeometry(r,o),c=t.getDepthImage(i);n([{metaData:r,bufferData:o,geometry:i},c])}))}},{key:"getDepthMapMetaData",value:function(e){return{metaDataSize:e.getUint8(0),numberOfPlanes:e.getUint16(1,!0),width:e.getUint16(3,!0),height:e.getUint16(5,!0),offset:e.getUint16(7,!0)}}},{key:"getStreetViewGeometry",value:function(e,t){for(var a=new Array(e.numberOfPlanes),n=i(e.width,e.height),o=0;o<e.height;o++)for(var r=0;r<e.width;r++)n[o][r]=t.getUint8(e.offset+r+o*e.width);for(var c=e.offset+e.height*e.width,l=0;l<e.numberOfPlanes;++l){var u=c+4*l*4;a[l]={n:{x:t.getFloat32(u,!0),y:t.getFloat32(u+4,!0),z:t.getFloat32(u+8,!0)},d:t.getFloat32(u+12,!0)}}return{width:e.width,height:e.height,planes:a,planeIndices:n}}},{key:"getDepthImage",value:function(e){for(var t,a,n=i(e.width,e.height),o=0;o<n.length;o++)for(var r=(e.height-o-.5)/e.height*Math.PI,c=Math.sin(r),l=Math.cos(r),u=0;u<n[0].length;u++){var h=e.planeIndices[o][u];if(h>0){var d=2*(e.width-u-.5)*Math.PI/e.width,s={x:c*Math.cos(d),y:c*Math.sin(d),z:l},m=e.planes[h],g=Math.abs(m.d/(t=m.n,a=s,t.x*a.x+t.y*a.y+t.z*a.z));n[o][u]=g}else n[o][u]=0}return n}}]),t}()}).call(this,a(2).Buffer)},30:function(e,t,a){e.exports=a(66)},35:function(e,t,a){},36:function(e,t,a){},40:function(e,t){},42:function(e,t){},63:function(e,t,a){},64:function(e,t,a){},65:function(e,t,a){},66:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(25),i=a.n(r),c=(a(35),a(1)),l=(a(36),a(26)),u=(a(63),function(e){var t=e.width,a=e.height,r=e.depthImage;return Object(n.useEffect)((function(){var e=document.getElementById("depth-image");if(r&&e){var n=e.getContext("2d");null===n||void 0===n||n.clearRect(0,0,t,a);for(var o=0,i=n.createImageData(t,a),c=0;c<a;++c)for(var l=0;l<t;++l){var u=c*t+l,h=2.5*r[c][l];i.data[4*u]=h,i.data[4*u+1]=h,i.data[4*u+2]=h,i.data[4*u+3]=255,o=Math.max(r[c][l],o)}null===n||void 0===n||n.putImageData(i,0,0)}}),[r,t,a]),o.a.createElement("canvas",{id:"depth-image",className:"depth-image-canvas",width:t,height:a})}),h=(a(64),{0:[255,255,255],1:[255,0,0],2:[0,255,0],3:[0,0,255],4:[255,255,0],5:[255,0,255],6:[0,255,255]}),d=function(e){var t=e.planesData;return Object(n.useEffect)((function(){var e=document.getElementById("depth-planes");if(e&&t){var a=e.getContext("2d");null===a||void 0===a||a.clearRect(0,0,512,256);for(var n=t.planeIndices,o=a.createImageData(t.width,t.height),r=0;r<t.height;++r)for(var i=0;i<t.width;++i){var c=r*t.width+i,l=h[n[r][i]];l&&(o.data[4*c]=l[0],o.data[4*c+1]=l[1],o.data[4*c+2]=l[2]),o.data[4*c+3]=255}null===a||void 0===a||a.putImageData(o,0,0)}}),[t]),o.a.createElement("canvas",{id:"depth-planes",width:(null===t||void 0===t?void 0:t.width)||512,height:(null===t||void 0===t?void 0:t.height)||256})},s=function(e){var t=e.depthMapData;return t?o.a.createElement("table",null,o.a.createElement("tbody",null,o.a.createElement("tr",null,o.a.createElement("td",null,"Number of Planes: "),o.a.createElement("td",null,t.metaData.numberOfPlanes)))):null},m=(a(65),function(e){var t=e.location,a=e.updateLocation,r=Object(n.useState)(void 0),i=Object(c.a)(r,2),l=i[0],u=i[1];return Object(n.useEffect)((function(){var e=new google.maps.StreetViewPanorama(document.getElementById("panorama"));e.addListener("position_changed",(function(){var t=e.getPosition();a(t.lat(),t.lng())})),u(e)}),[]),Object(n.useEffect)((function(){l&&(new google.maps.StreetViewService).getPanorama({location:t,radius:50},(function(e,t){t===google.maps.StreetViewStatus.OK&&(l.setPano(e.location.pano),l.setVisible(!0))}))}),[l,t]),o.a.createElement("div",{id:"panorama",style:{width:512,height:512}})}),g=parseFloat("37.77717636796375,-122.3951574097429".split(",")[0]),f=parseFloat("37.77717636796375,-122.3951574097429".split(",")[1]),p=function(){var e=Object(n.useState)(void 0),t=Object(c.a)(e,2),a=t[0],r=t[1],i=Object(n.useState)(void 0),h=Object(c.a)(i,2),p=h[0],v=h[1],w=Object(n.useState)(void 0),b=Object(c.a)(w,2),E=b[0],y=b[1],O=Object(n.useState)(new google.maps.LatLng(g,f)),j=Object(c.a)(O,2),D=j[0],S=j[1];Object(n.useEffect)((function(){try{l.a.fetchStreetViewImage(D.lat(),D.lng(),(function(e){var t=Object(c.a)(e,2),a=t[0],n=t[1];r(a),v(a.geometry),y(n)}))}catch(e){console.log(e)}}),[D]);return o.a.createElement("div",{className:"App"},o.a.createElement("header",{className:"App-header"},o.a.createElement("h2",null,"Reconstrct Depth Maps from Google Street View"),o.a.createElement("h4",null,"Navigate on the Street View Panorama to see the reconstructed depth maps"),o.a.createElement("div",{className:"App-header_info"},o.a.createElement("label",null,"Latitude: ",D.lat().toFixed(4)),o.a.createElement("br",null),o.a.createElement("label",null,"Longitude: ",D.lng().toFixed(4)),o.a.createElement(s,{depthMapData:a}))),o.a.createElement("div",{className:"App-body"},o.a.createElement("div",{className:"App-body__depth-maps"},o.a.createElement("h4",null,"Detected planes color-coded by index"),o.a.createElement(d,{planesData:p}),o.a.createElement("h4",null,"Shaded depth image based on depth"),o.a.createElement(u,{width:512,height:256,depthImage:E})),o.a.createElement("div",{className:"App-body__panorama"},o.a.createElement("h4",null,"StreeView Panorama"),o.a.createElement(m,{location:D,updateLocation:function(e,t){S(new google.maps.LatLng(e,t))}}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(p,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[30,1,2]]]);
//# sourceMappingURL=main.bac370fa.chunk.js.map