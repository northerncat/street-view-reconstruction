(this["webpackJsonpstreet-view-reconstruction"]=this["webpackJsonpstreet-view-reconstruction"]||[]).push([[0],{14:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l}));var a=n(27),r=n(28),o=n(29);function i(e,t){for(var n=new Array(t),a=0;a<t;a++)n[a]=new Array(e);return n}function c(e){return"http://maps.google.com/cbk?"+Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")}var l=function(){function t(){Object(a.a)(this,t)}return Object(r.a)(t,null,[{key:"fetchStreetViewImage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=c({output:"json",ll:"".concat(e,",").concat(t),dm:1});return fetch(n).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()}))}},{key:"parseDepthMapString",value:function(n,a){for(;n.length%4!==0;)n+="=";n=(n=n.replace(/-/g,"+")).replace(/_/g,"/"),Object(o.inflate)(e.from(n,"base64"),(function(e,n){if(e)throw e;var r=function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;++n)t[n]=e[n];return new DataView(t.buffer)}(n),o=t.getDepthMapMetaData(r),i=t.getStreetViewGeometry(o,r),c=t.getDepthImage(i);a([{metaData:o,bufferData:r,geometry:i},c])}))}},{key:"getDepthMapMetaData",value:function(e){return{metaDataSize:e.getUint8(0),numberOfPlanes:e.getUint16(1,!0),width:e.getUint16(3,!0),height:e.getUint16(5,!0),offset:e.getUint16(7,!0)}}},{key:"getStreetViewGeometry",value:function(e,t){for(var n=new Array(e.numberOfPlanes),a=i(e.width,e.height),r=0;r<e.height;r++)for(var o=0;o<e.width;o++)a[r][o]=t.getUint8(e.offset+o+r*e.width);for(var c=e.offset+e.height*e.width,l=0;l<e.numberOfPlanes;++l){var u=c+4*l*4;n[l]={n:{x:t.getFloat32(u,!0),y:t.getFloat32(u+4,!0),z:t.getFloat32(u+8,!0)},d:t.getFloat32(u+12,!0)}}return{width:e.width,height:e.height,planes:n,planeIndices:a}}},{key:"getDepthImage",value:function(e){for(var t,n,a=i(e.width,e.height),r=0;r<a.length;r++)for(var o=(e.height-r-.5)/e.height*Math.PI,c=Math.sin(o),l=Math.cos(o),u=0;u<a[0].length;u++){var h=e.planeIndices[r][u];if(h>0){var f=2*(e.width-u-.5)*Math.PI/e.width,s={x:c*Math.cos(f),y:c*Math.sin(f),z:l},g=e.planes[h],m=Math.abs(g.d/(t=g.n,n=s,t.x*n.x+t.y*n.y+t.z*n.z));a[r][u]=m}else a[r][u]=0}return a}}]),t}()}).call(this,n(1).Buffer)},30:function(e,t,n){e.exports=n(63)},35:function(e,t,n){},36:function(e,t,n){},40:function(e,t){},42:function(e,t){},63:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(26),i=n.n(o),c=(n(35),n(9)),l=(n(36),n(14)),u=parseFloat("37.7769799,-122.3949447".split(",")[0]),h=parseFloat("37.7769799,-122.3949447".split(",")[1]),f={0:[255,255,255],1:[255,0,0],2:[0,255,0],3:[0,0,255],4:[255,255,0],5:[255,0,255],6:[0,255,255]},s=function(){var e=Object(a.useState)(void 0),t=Object(c.a)(e,2),n=t[0],o=t[1],i=Object(a.useState)(void 0),s=Object(c.a)(i,2),g=s[0],m=s[1],d=function(e){var t=Object(c.a)(e,2),n=t[0],a=t[1];o(n),m(a)};Object(a.useEffect)((function(){try{l.a.fetchStreetViewImage(u,h).then((function(e){l.a.parseDepthMapString(e.model.depth_map,d)}))}catch(e){console.log(e)}}),[]);Object(a.useEffect)((function(){var e=document.getElementById("depth-map");if(e){var t=e.getContext("2d");if(null===t||void 0===t||t.clearRect(0,0,512,256),n){for(var a=n.geometry.planeIndices,r=t.createImageData(n.geometry.width,n.geometry.height),o=0;o<a.length;++o)for(var i=0;i<a[0].length;++i){var c=o*a[0].length+i,l=f[a[o][i]];l&&(r.data[4*c]=l[0],r.data[4*c+1]=l[1],r.data[4*c+2]=l[2]),r.data[4*c+3]=255}null===t||void 0===t||t.putImageData(r,0,0)}}}),[g,n,!1]);var p=n&&r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"Number of Planes"),r.a.createElement("td",null,n.metaData.numberOfPlanes))));return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("label",null,"Latitude: ",u),r.a.createElement("label",null,"Longitude: ",h),r.a.createElement("br",null),p,r.a.createElement("br",null),r.a.createElement("canvas",{id:"depth-map",width:512,height:256})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(s,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[30,1,2]]]);
//# sourceMappingURL=main.98268227.chunk.js.map